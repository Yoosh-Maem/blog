"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard").default;

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.insertBeforeEachLine = insertBeforeEachLine;
exports.checkedListCommand = exports.orderedListCommand = exports.unorderedListCommand = exports.makeList = void 0;

var React = _interopRequireWildcard(require("react"));

var _markdownUtils = require("../utils/markdownUtils");

/**
 * Inserts insertionString before each line
 */
function insertBeforeEachLine(selectedText, insertBefore) {
  var lines = selectedText.split(/\n/);
  var insertionLength = 0;
  var modifiedText = lines.map(function (item, index) {
    if (typeof insertBefore === 'string') {
      insertionLength += insertBefore.length;
      return insertBefore + item;
    } else if (typeof insertBefore === 'function') {
      var insertionResult = insertBefore(item, index);
      insertionLength += insertionResult.length;
      return insertBefore(item, index) + item;
    }

    throw Error('insertion is expected to be either a string or a function');
  }).join('\n');
  return {
    modifiedText: modifiedText,
    insertionLength: insertionLength
  };
}

var makeList = function makeList(state, api, insertBefore) {
  // Adjust the selection to encompass the whole word if the caret is inside one
  var newSelectionRange = (0, _markdownUtils.selectWord)({
    text: state.text,
    selection: state.selection
  });
  var state1 = api.setSelectionRange(newSelectionRange);
  var breaksBeforeCount = (0, _markdownUtils.getBreaksNeededForEmptyLineBefore)(state1.text, state1.selection.start);
  var breaksBefore = Array(breaksBeforeCount + 1).join('\n');
  var breaksAfterCount = (0, _markdownUtils.getBreaksNeededForEmptyLineAfter)(state1.text, state1.selection.end);
  var breaksAfter = Array(breaksAfterCount + 1).join('\n');
  var modifiedText = insertBeforeEachLine(state1.selectedText, insertBefore);
  api.replaceSelection("".concat(breaksBefore).concat(modifiedText.modifiedText).concat(breaksAfter)); // Specifically when the text has only one line, we can exclude the "- ", for example, from the selection

  var oneLinerOffset = state1.selectedText.indexOf('\n') === -1 ? modifiedText.insertionLength : 0;
  var selectionStart = state1.selection.start + breaksBeforeCount + oneLinerOffset;
  var selectionEnd = selectionStart + modifiedText.modifiedText.length - oneLinerOffset; // Adjust the selection to not contain the **

  api.setSelectionRange({
    start: selectionStart,
    end: selectionEnd
  });
};

exports.makeList = makeList;
var unorderedListCommand = {
  name: 'unordered-list',
  keyCommand: 'list',
  shortcuts: 'ctrl+shift+l',
  buttonProps: {
    'aria-label': 'Add unordered list',
    title: 'Add unordered list'
  },
  icon: /*#__PURE__*/React.createElement("svg", {
    "data-name": "unordered-list",
    width: "12",
    height: "12",
    viewBox: "0 0 512 512"
  }, /*#__PURE__*/React.createElement("path", {
    fill: "currentColor",
    d: "M96 96c0 26.51-21.49 48-48 48S0 122.51 0 96s21.49-48 48-48 48 21.49 48 48zM48 208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm0 160c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm96-236h352c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"
  })),
  execute: function execute(state, api) {
    makeList(state, api, '- ');
  }
};
exports.unorderedListCommand = unorderedListCommand;
var orderedListCommand = {
  name: 'ordered-list',
  keyCommand: 'list',
  shortcuts: 'ctrl+shift+o',
  buttonProps: {
    'aria-label': 'Add ordered list',
    title: 'Add ordered list'
  },
  icon: /*#__PURE__*/React.createElement("svg", {
    "data-name": "ordered-list",
    width: "12",
    height: "12",
    role: "img",
    viewBox: "0 0 512 512"
  }, /*#__PURE__*/React.createElement("path", {
    fill: "currentColor",
    d: "M3.263 139.527c0-7.477 3.917-11.572 11.573-11.572h15.131V88.078c0-5.163.534-10.503.534-10.503h-.356s-1.779 2.67-2.848 3.738c-4.451 4.273-10.504 4.451-15.666-1.068l-5.518-6.231c-5.342-5.341-4.984-11.216.534-16.379l21.72-19.938C32.815 33.602 36.732 32 42.785 32H54.89c7.656 0 11.749 3.916 11.749 11.572v84.384h15.488c7.655 0 11.572 4.094 11.572 11.572v8.901c0 7.477-3.917 11.572-11.572 11.572H14.836c-7.656 0-11.573-4.095-11.573-11.572v-8.902zM2.211 304.591c0-47.278 50.955-56.383 50.955-69.165 0-7.18-5.954-8.755-9.28-8.755-3.153 0-6.479 1.051-9.455 3.852-5.079 4.903-10.507 7.004-16.111 2.451l-8.579-6.829c-5.779-4.553-7.18-9.805-2.803-15.409C13.592 201.981 26.025 192 47.387 192c19.437 0 44.476 10.506 44.476 39.573 0 38.347-46.753 46.402-48.679 56.909h39.049c7.529 0 11.557 4.027 11.557 11.382v8.755c0 7.354-4.028 11.382-11.557 11.382h-67.94c-7.005 0-12.083-4.028-12.083-11.382v-4.028zM5.654 454.61l5.603-9.28c3.853-6.654 9.105-7.004 15.584-3.152 4.903 2.101 9.63 3.152 14.359 3.152 10.155 0 14.358-3.502 14.358-8.23 0-6.654-5.604-9.106-15.934-9.106h-4.728c-5.954 0-9.28-2.101-12.258-7.88l-1.05-1.926c-2.451-4.728-1.226-9.806 2.801-14.884l5.604-7.004c6.829-8.405 12.257-13.483 12.257-13.483v-.35s-4.203 1.051-12.608 1.051H16.685c-7.53 0-11.383-4.028-11.383-11.382v-8.755c0-7.53 3.853-11.382 11.383-11.382h58.484c7.529 0 11.382 4.027 11.382 11.382v3.327c0 5.778-1.401 9.806-5.079 14.183l-17.509 20.137c19.611 5.078 28.716 20.487 28.716 34.845 0 21.363-14.358 44.126-48.503 44.126-16.636 0-28.192-4.728-35.896-9.455-5.779-4.202-6.304-9.805-2.626-15.934zM144 132h352c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"
  })),
  execute: function execute(state, api) {
    makeList(state, api, function (item, index) {
      return "".concat(index + 1, ". ");
    });
  }
};
exports.orderedListCommand = orderedListCommand;
var checkedListCommand = {
  name: 'checked-list',
  keyCommand: 'list',
  shortcuts: 'ctrl+shift+c',
  buttonProps: {
    'aria-label': 'Add checked list',
    title: 'Add checked list'
  },
  icon: /*#__PURE__*/React.createElement("svg", {
    "data-name": "checked-list",
    width: "12",
    height: "12",
    role: "img",
    viewBox: "0 0 512 512"
  }, /*#__PURE__*/React.createElement("path", {
    fill: "currentColor",
    d: "M208 132h288c8.8 0 16-7.2 16-16V76c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16v40c0 8.8 7.2 16 16 16zm0 160h288c8.8 0 16-7.2 16-16v-40c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16v40c0 8.8 7.2 16 16 16zm0 160h288c8.8 0 16-7.2 16-16v-40c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16v40c0 8.8 7.2 16 16 16zM64 368c-26.5 0-48.6 21.5-48.6 48s22.1 48 48.6 48 48-21.5 48-48-21.5-48-48-48zm92.5-299l-72.2 72.2-15.6 15.6c-4.7 4.7-12.9 4.7-17.6 0L3.5 109.4c-4.7-4.7-4.7-12.3 0-17l15.7-15.7c4.7-4.7 12.3-4.7 17 0l22.7 22.1 63.7-63.3c4.7-4.7 12.3-4.7 17 0l17 16.5c4.6 4.7 4.6 12.3-.1 17zm0 159.6l-72.2 72.2-15.7 15.7c-4.7 4.7-12.9 4.7-17.6 0L3.5 269c-4.7-4.7-4.7-12.3 0-17l15.7-15.7c4.7-4.7 12.3-4.7 17 0l22.7 22.1 63.7-63.7c4.7-4.7 12.3-4.7 17 0l17 17c4.6 4.6 4.6 12.2-.1 16.9z"
  })),
  execute: function execute(state, api) {
    makeList(state, api, function (item, index) {
      return "- [ ] ";
    });
  }
};
exports.checkedListCommand = checkedListCommand;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tYW5kcy9saXN0LnRzeCJdLCJuYW1lcyI6WyJpbnNlcnRCZWZvcmVFYWNoTGluZSIsInNlbGVjdGVkVGV4dCIsImluc2VydEJlZm9yZSIsImxpbmVzIiwic3BsaXQiLCJpbnNlcnRpb25MZW5ndGgiLCJtb2RpZmllZFRleHQiLCJtYXAiLCJpdGVtIiwiaW5kZXgiLCJsZW5ndGgiLCJpbnNlcnRpb25SZXN1bHQiLCJFcnJvciIsImpvaW4iLCJtYWtlTGlzdCIsInN0YXRlIiwiYXBpIiwibmV3U2VsZWN0aW9uUmFuZ2UiLCJ0ZXh0Iiwic2VsZWN0aW9uIiwic3RhdGUxIiwic2V0U2VsZWN0aW9uUmFuZ2UiLCJicmVha3NCZWZvcmVDb3VudCIsInN0YXJ0IiwiYnJlYWtzQmVmb3JlIiwiQXJyYXkiLCJicmVha3NBZnRlckNvdW50IiwiZW5kIiwiYnJlYWtzQWZ0ZXIiLCJyZXBsYWNlU2VsZWN0aW9uIiwib25lTGluZXJPZmZzZXQiLCJpbmRleE9mIiwic2VsZWN0aW9uU3RhcnQiLCJzZWxlY3Rpb25FbmQiLCJ1bm9yZGVyZWRMaXN0Q29tbWFuZCIsIm5hbWUiLCJrZXlDb21tYW5kIiwic2hvcnRjdXRzIiwiYnV0dG9uUHJvcHMiLCJ0aXRsZSIsImljb24iLCJleGVjdXRlIiwib3JkZXJlZExpc3RDb21tYW5kIiwiY2hlY2tlZExpc3RDb21tYW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7O0FBRUE7O0FBUUE7QUFDQTtBQUNBO0FBQ08sU0FBU0Esb0JBQVQsQ0FDTEMsWUFESyxFQUVMQyxZQUZLLEVBRzhDO0FBQ25ELE1BQU1DLEtBQUssR0FBR0YsWUFBWSxDQUFDRyxLQUFiLENBQW1CLElBQW5CLENBQWQ7QUFFQSxNQUFJQyxlQUFlLEdBQUcsQ0FBdEI7QUFDQSxNQUFNQyxZQUFZLEdBQUdILEtBQUssQ0FDdkJJLEdBRGtCLENBQ2QsVUFBQ0MsSUFBRCxFQUFPQyxLQUFQLEVBQWlCO0FBQ3BCLFFBQUksT0FBT1AsWUFB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QUFDRDtBQWZ5QyxDQUFyQzs7QUFrQkEsSUFBTWtDLGtCQUE0QixHQUFHO0FBQzFDUixFQUFBQSxJQUFJLEVBQUUsY0FEb0M7QUFFMUNDLEVBQUFBLFVBQVUsRUFBRSxNQUY4QjtBQUcxQ0MsRUFBQUEsU0FBUyxFQUFFLGNBSCtCO0FBSTFDQyxFQUFBQSxXQUFXLEVBQUU7QUFBRSxrQkFBYyxrQkFBaEI7QUFBb0NDLElBQUFBLEtBQUssRUFBRTtBQUEzQyxHQUo2QjtBQUsxQ0MsRUFBQUEsSUFBSSxlQUNGO0FBQUssaUJBQVUsY0FBZjtBQUE4QixJQUFBLEtBQUssRUFBQyxJQUFwQztBQUF5QyxJQUFBLE1BQU0sRUFBQyxJQUFoRDtBQUFxRCxJQUFBLElBQUksRUFBQyxLQUExRDtBQUFnRSxJQUFBLE9BQU8sRUFBQztBQUF4RSxrQkFDRTtBQUNFLElBQUEsSUFBSSxFQUFDLGNBRFA7QUFFRSxJQUFBLENBQUMsRUFBQztBQUZKLElBREYsQ0FOd0M7QUFhMUNDLEVBQUFBLE9BQU8sRUFBRSxpQkFBQzFCLEtBQUQsRUFBbUJDLEdBQW5CLEVBQW9DO0FBQzNDRixJQUFBQSxRQUFRLENBQUNDLEtBQUQsRUFBUUMsR0FBUixFQUFhLFVBQUNSLElBQUQsRUFBT0MsS0FBUDtBQUFBO0FBQUEsS0FBYixDQUFSO0FBQ0Q7QUFmeUMsQ0FBckMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBJQ29tbWFuZCwgVGV4dFN0YXRlLCBUZXh0QXBpIH0gZnJvbSAnLi8nO1xuaW1wb3J0IHtcbiAgc2VsZWN0V29yZCxcbiAgZ2V0QnJlYWtzTmVlZGVkRm9yRW1wdHlMaW5lQmVmb3JlLFxuICBnZXRCcmVha3NOZWVkZWRGb3JFbXB0eUxpbmVBZnRlcixcbn0gZnJvbSAnLi4vdXRpbHMvbWFya2Rvd25VdGlscyc7XG5cbmV4cG9ydCB0eXBlIEFsdGVyTGluZUZ1bmN0aW9uID0gKGxpbmU6IHN0cmluZywgaW5kZXg6IG51bWJlcikgPT4gc3RyaW5nO1xuXG4vKipcbiAqIEluc2VydHMgaW5zZXJ0aW9uU3RyaW5nIGJlZm9yZSBlYWNoIGxpbmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluc2VydEJlZm9yZUVhY2hMaW5lKFxuICBzZWxlY3RlZFRleHQ6IHN0cmluZyxcbiAgaW5zZXJ0QmVmb3JlOiBzdHJpbmcgfCBBbHRlckxpbmVGdW5jdGlvbixcbik6IHsgbW9kaWZpZWRUZXh0OiBzdHJpbmc7IGluc2VydGlvbkxlbmd0aDogbnVtYmVyIH0ge1xuICBjb25zdCBsaW5lcyA9IHNlbGVjdGVkVGV4dC5zcGxpdCgvXFxuLyk7XG5cbiAgbGV0IGluc2VydGlvbkxlbmd0aCA9IDA7XG4gIGNvbnN0IG1vZGlmaWVkVGV4dCA9IGxpbmVzXG4gICAgLm1hcCgoaXRlbSwgaW5kZXgpID0+IHtcbiAgICAgIGlmICh0eXBlb2YgaW5zZXJ0QmVmb3JlID09PSAnc3RyaW5nJykge1xuICAgICAgICBpbnNlcnRpb25MZW5ndGggKz0gaW5zZXJ0QmVmb3JlLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIGluc2VydEJlZm9yZSArIGl0ZW07XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBpbnNlcnRCZWZvcmUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY29uc3QgaW5zZXJ0aW9uUmVzdWx0ID0gaW5zZXJ0QmVmb3JlKGl0ZW0sIGluZGV4KTtcbiAgICAgICAgaW5zZXJ0aW9uTGVuZ3RoICs9IGluc2VydGlvblJlc3VsdC5sZW5ndGg7XG4gICAgICAgIHJldHVybiBpbnNlcnRCZWZvcmUoaXRlbSwgaW5kZXgpICsgaXRlbTtcbiAgICAgIH1cbiAgICAgIHRocm93IEVycm9yKCdpbnNlcnRpb24gaXMgZXhwZWN0ZWQgdG8gYmUgZWl0aGVyIGEgc3RyaW5nIG9yIGEgZnVuY3Rpb24nKTtcbiAgICB9KVxuICAgIC5qb2luKCdcXG4nKTtcblxuICByZXR1cm4geyBtb2RpZmllZFRleHQsIGluc2VydGlvbkxlbmd0aCB9O1xufVxuXG5leHBvcnQgY29uc3QgbWFrZUxpc3QgPSAoc3RhdGU6IFRleHRTdGF0ZSwgYXBpOiBUZXh0QXBpLCBpbnNlcnRCZWZvcmU6IHN0cmluZyB8IEFsdGVyTGluZUZ1bmN0aW9uKSA9PiB7XG4gIC8vIEFkanVzdCB0aGUgc2VsZWN0aW9uIHRvIGVuY29tcGFzcyB0aGUgd2hvbGUgd29yZCBpZiB0aGUgY2FyZXQgaXMgaW5zaWRlIG9uZVxuICBjb25zdCBuZXdTZWxlY3Rpb25SYW5nZSA9IHNlbGVjdFdvcmQoeyB0ZXh0OiBzdGF0ZS50ZXh0LCBzZWxlY3Rpb246IHN0YXRlLnNlbGVjdGlvbiB9KTtcbiAgY29uc3Qgc3RhdGUxID0gYXBpLnNldFNlbGVjdGlvblJhbmdlKG5ld1NlbGVjdGlvblJhbmdlKTtcblxuICBjb25zdCBicmVha3NCZWZvcmVDb3VudCA9IGdldEJyZWFrc05lZWRlZEZvckVtcHR5TGluZUJlZm9yZShzdGF0ZTEudGV4dCwgc3RhdGUxLnNlbGVjdGlvbi5zdGFydCk7XG4gIGNvbnN0IGJyZWFrc0JlZm9yZSA9IEFycmF5KGJyZWFrc0JlZm9yZUNvdW50ICsgMSkuam9pbignXFxuJyk7XG5cbiAgY29uc3QgYnJlYWtzQWZ0ZXJDb3VudCA9IGdldEJyZWFrc05lZWRlZEZvckVtcHR5TGluZUFmdGVyKHN0YXRlMS50ZXh0LCBzdGF0ZTEuc2VsZWN0aW9uLmVuZCk7XG4gIGNvbnN0IGJyZWFrc0FmdGVyID0gQXJyYXkoYnJlYWtzQWZ0ZXJDb3VudCArIDEpLmpvaW4oJ1xcbicpO1xuXG4gIGNvbnN0IG1vZGlmaWVkVGV4dCA9IGluc2VydEJlZm9yZUVhY2hMaW5lKHN0YXRlMS5zZWxlY3RlZFRleHQsIGluc2VydEJlZm9yZSk7XG5cbiAgYXBpLnJlcGxhY2VTZWxlY3Rpb24oYCR7YnJlYWtzQmVmb3JlfSR7bW9kaWZpZWRUZXh0Lm1vZGlmaWVkVGV4dH0ke2JyZWFrc0FmdGVyfWApO1xuXG4gIC8vIFNwZWNpZmljYWxseSB3aGVuIHRoZSB0ZXh0IGhhcyBvbmx5IG9uZSBsaW5lLCB3ZSBjYW4gZXhjbHVkZSB0aGUgXCItIFwiLCBmb3IgZXhhbXBsZSwgZnJvbSB0aGUgc2VsZWN0aW9uXG4gIGNvbnN0IG9uZUxpbmVyT2Zmc2V0ID0gc3RhdGUxLnNlbGVjdGVkVGV4dC5pbmRleE9mKCdcXG4nKSA9PT0gLTEgPyBtb2RpZmllZFRleHQuaW5zZXJ0aW9uTGVuZ3RoIDogMDtcblxuICBjb25zdCBzZWxlY3Rpb25TdGFydCA9IHN0YXRlMS5zZWxlY3Rpb24uc3RhcnQgKyBicmVha3NCZWZvcmVDb3VudCArIG9uZUxpbmVyT2Zmc2V0O1xuICBjb25zdCBzZWxlY3Rpb25FbmQgPSBzZWxlY3Rpb25TdGFydCArIG1vZGlmaWVkVGV4dC5tb2RpZmllZFRleHQubGVuZ3RoIC0gb25lTGluZXJPZmZzZXQ7XG5cbiAgLy8gQWRqdXN0IHRoZSBzZWxlY3Rpb24gdG8gbm90IGNvbnRhaW4gdGhlICoqXG4gIGFwaS5zZXRTZWxlY3Rpb25SYW5nZSh7XG4gICAgc3RhcnQ6IHNlbGVjdGlvblN0YXJ0LFxuICAgIGVuZDogc2VsZWN0aW9uRW5kLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCB1bm9yZGVyZWRMaXN0Q29tbWFuZDogSUNvbW1hbmQgPSB7XG4gIG5hbWU6ICd1bm9yZGVyZWQtbGlzdCcsXG4gIGtleUNvbW1hbmQ6ICdsaXN0JyxcbiAgc2hvcnRjdXRzOiAnY3RybCtzaGlmdCtsJyxcbiAgYnV0dG9uUHJvcHM6IHsgJ2FyaWEtbGFiZWwnOiAnQWRkIHVub3JkZXJlZCBsaXN0JywgdGl0bGU6ICdBZGQgdW5vcmRlcmVkIGxpc3QnIH0sXG4gIGljb246IChcbiAgICA8c3ZnIGRhdGEtbmFtZT1cInVub3JkZXJlZC1saXN0XCIgd2lkdGg9XCIxMlwiIGhlaWdodD1cIjEyXCIgdmlld0JveD1cIjAgMCA1MTIgNTEyXCI+XG4gICAgICA8cGF0aFxuICAgICAgICBmaWxsPVwiY3VycmVudENvbG9yXCJcbiAgICAgICAgZD1cIk05NiA5NmMwIDI2LjUxLTIxLjQ5IDQ4LTQ4IDQ4UzAgMTIyLjUxIDAgOTZzMjEuNDktNDggNDgtNDggNDggMjEuNDkgNDggNDh6TTQ4IDIwOGMtMjYuNTEgMC00OCAyMS40OS00OCA0OHMyMS40OSA0OCA0OCA0OCA0OC0yMS40OSA0OC00OC0yMS40OS00OC00OC00OHptMCAxNjBjLTI2LjUxIDAtNDggMjEuNDktNDggNDhzMjEuNDkgNDggNDggNDggNDgtMjEuNDkgNDgtNDgtMjEuNDktNDgtNDgtNDh6bTk2LTIzNmgzNTJjOC44MzcgMCAxNi03LjE2MyAxNi0xNlY3NmMwLTguODM3LTcuMTYzLTE2LTE2LTE2SDE0NGMtOC44MzcgMC0xNiA3LjE2My0xNiAxNnY0MGMwIDguODM3IDcuMTYzIDE2IDE2IDE2em0wIDE2MGgzNTJjOC44MzcgMCAxNi03LjE2MyAxNi0xNnYtNDBjMC04LjgzNy03LjE2My0xNi0xNi0xNkgxNDRjLTguODM3IDAtMTYgNy4xNjMtMTYgMTZ2NDBjMCA4LjgzNyA3LjE2MyAxNiAxNiAxNnptMCAxNjBoMzUyYzguODM3IDAgMTYtNy4xNjMgMTYtMTZ2LTQwYzAtOC44MzctNy4xNjMtMTYtMTYtMTZIMTQ0Yy04LjgzNyAwLTE2IDcuMTYzLTE2IDE2djQwYzAgOC44MzcgNy4xNjMgMTYgMTYgMTZ6XCJcbiAgICAgIC8+XG4gICAgPC9zdmc+XG4gICksXG4gIGV4ZWN1dGU6IChzdGF0ZTogVGV4dFN0YXRlLCBhcGk6IFRleHRBcGkpID0+IHtcbiAgICBtYWtlTGlzdChzdGF0ZSwgYXBpLCAnLSAnKTtcbiAgfSxcbn07XG5cbmV4cG9ydCBjb25zdCBvcmRlcmVkTGlzdENvbW1hbmQ6IElDb21tYW5kID0ge1xuICBuYW1lOiAnb3JkZXJlZC1saXN0JyxcbiAga2V5Q29tbWFuZDogJ2xpc3QnLFxuICBzaG9ydGN1dHM6ICdjdHJsK3NoaWZ0K28nLFxuICBidXR0b25Qcm9wczogeyAnYXJpYS1sYWJlbCc6ICdBZGQgb3JkZXJlZCBsaXN0JywgdGl0bGU6ICdBZGQgb3JkZXJlZCBsaXN0JyB9LFxuICBpY29uOiAoXG4gICAgPHN2ZyBkYXRhLW5hbWU9XCJvcmRlcmVkLWxpc3RcIiB3aWR0aD1cIjEyXCIgaGVpZ2h0PVwiMTJcIiByb2xlPVwiaW1nXCIgdmlld0JveD1cIjAgMCA1MTIgNTEyXCI+XG4gICAgICA8cGF0aFxuICAgICAgICBmaWxsPVwiY3VycmVudENvbG9yXCJcbiAgICAgICAgZD1cIk0zLjI2MyAxMzkuNTI3YzAtNy40NzcgMy45MTctMTEuNTcyIDExLjU3My0xMS41NzJoMTUuMTMxVjg4LjA3OGMwLTUuMTYzLjUzNC0xMC41MDMuNTM0LTEwLjUwM2gtLjM1NnMtMS43NzkgMi42Ny0yLjg0OCAzLjczOGMtNC40NTEgNC4yNzMtMTAuNTA0IDQuNDUxLTE1LjY2Ni0xLjA2OGwtNS41MTgtNi4yMzFjLTUuMzQyLTUuMzQxLTQuOTg0LTExLjIxNi41MzQtMTYuMzc5bDIxLjcyLTE5LjkzOEMzMi44MTUgMzMuNjAyIDM2LjczMiAzMiA0Mi43ODUgMzJINTQuODljNy42NTYgMCAxMS43NDkgMy45MTYgMTEuNzQ5IDExLjU3MnY4NC4zODRoMTUuNDg4YzcuNjU1IDAgMTEuNTcyIDQuMDk0IDExLjU3MiAxMS41NzJ2OC45MDFjMCA3LjQ3Ny0zLjkxNyAxMS41NzItMTEuNTcyIDExLjU3MkgxNC44MzZjLTcuNjU2IDAtMTEuNTczLTQuMDk1LTExLjU3My0xMS41NzJ2LTguOTAyek0yLjIxMSAzMDQuNTkxYzAtNDcuMjc4IDUwLjk1NS01Ni4zODMgNTAuOTU1LTY5LjE2NSAwLTcuMTgtNS45NTQtOC43NTUtOS4yOC04Ljc1NS0zLjE1MyAwLTYuNDc5IDEuMDUxLTkuNDU1IDMuODUyLTUuMDc5IDQuOTAzLTEwLjUwNyA3LjAwNC0xNi4xMTEgMi40NTFsLTguNTc5LTYuODI5Yy01Ljc3OS00LjU1My03LjE4LTkuODA1LTIuODAzLTE1LjQwOUMxMy41OTIgMjAxLjk4MSAyNi4wMjUgMTkyIDQ3LjM4NyAxOTJjMTkuNDM3IDAgNDQuNDc2IDEwLjUwNiA0NC40NzYgMzkuNTczIDAgMzguMzQ3LTQ2Ljc1MyA0Ni40MDItNDguNjc5IDU2LjkwOWgzOS4wNDljNy41MjkgMCAxMS41NTcgNC4wMjcgMTEuNTU3IDExLjM4MnY4Ljc1NWMwIDcuMzU0LTQuMDI4IDExLjM4Mi0xMS41NTcgMTEuMzgyaC02Ny45NGMtNy4wMDUgMC0xMi4wODMtNC4wMjgtMTIuMDgzLTExLjM4MnYtNC4wMjh6TTUuNjU0IDQ1NC42MWw1LjYwMy05LjI4YzMuODUzLTYuNjU0IDkuMTA1LTcuMDA0IDE1LjU4NC0zLjE1MiA0LjkwMyAyLjEwMSA5LjYzIDMuMTUyIDE0LjM1OSAzLjE1MiAxMC4xNTUgMCAxNC4zNTgtMy41MDIgMTQuMzU4LTguMjMgMC02LjY1NC01LjYwNC05LjEwNi0xNS45MzQtOS4xMDZoLTQuNzI4Yy01Ljk1NCAwLTkuMjgtMi4xMDEtMTIuMjU4LTcuODhsLTEuMDUtMS45MjZjLTIuNDUxLTQuNzI4LTEuMjI2LTkuODA2IDIuODAxLTE0Ljg4NGw1LjYwNC03LjAwNGM2LjgyOS04LjQwNSAxMi4yNTctMTMuNDgzIDEyLjI1Ny0xMy40ODN2LS4zNXMtNC4yMDMgMS4wNTEtMTIuNjA4IDEuMDUxSDE2LjY4NWMtNy41MyAwLTExLjM4My00LjAyOC0xMS4zODMtMTEuMzgydi04Ljc1NWMwLTcuNTMgMy44NTMtMTEuMzgyIDExLjM4My0xMS4zODJoNTguNDg0YzcuNTI5IDAgMTEuMzgyIDQuMDI3IDExLjM4MiAxMS4zODJ2My4zMjdjMCA1Ljc3OC0xLjQwMSA5LjgwNi01LjA3OSAxNC4xODNsLTE3LjUwOSAyMC4xMzdjMTkuNjExIDUuMDc4IDI4LjcxNiAyMC40ODcgMjguNzE2IDM0Ljg0NSAwIDIxLjM2My0xNC4zNTggNDQuMTI2LTQ4LjUwMyA0NC4xMjYtMTYuNjM2IDAtMjguMTkyLTQuNzI4LTM1Ljg5Ni05LjQ1NS01Ljc3OS00LjIwMi02LjMwNC05LjgwNS0yLjYyNi0xNS45MzR6TTE0NCAxMzJoMzUyYzguODM3IDAgMTYtNy4xNjMgMTYtMTZWNzZjMC04LjgzNy03LjE2My0xNi0xNi0xNkgxNDRjLTguODM3IDAtMTYgNy4xNjMtMTYgMTZ2NDBjMCA4LjgzNyA3LjE2MyAxNiAxNiAxNnptMCAxNjBoMzUyYzguODM3IDAgMTYtNy4xNjMgMTYtMTZ2LTQwYzAtOC44MzctNy4xNjMtMTYtMTYtMTZIMTQ0Yy04LjgzNyAwLTE2IDcuMTYzLTE2IDE2djQwYzAgOC44MzcgNy4xNjMgMTYgMTYgMTZ6bTAgMTYwaDM1MmM4LjgzNyAwIDE2LTcuMTYzIDE2LTE2di00MGMwLTguODM3LTcuMTYzLTE2LTE2LTE2SDE0NGMtOC44MzcgMC0xNiA3LjE2My0xNiAxNnY0MGMwIDguODM3IDcuMTYzIDE2IDE2IDE2elwiXG4gICAgICAvPlxuICAgIDwvc3ZnPlxuICApLFxuICBleGVjdXRlOiAoc3RhdGU6IFRleHRTdGF0ZSwgYXBpOiBUZXh0QXBpKSA9PiB7XG4gICAgbWFrZUxpc3Qoc3RhdGUsIGFwaSwgKGl0ZW0sIGluZGV4KSA9PiBgJHtpbmRleCArIDF9LiBgKTtcbiAgfSxcbn07XG5cbmV4cG9ydCBjb25zdCBjaGVja2VkTGlzdENvbW1hbmQ6IElDb21tYW5kID0ge1xuICBuYW1lOiAnY2hlY2tlZC1saXN0JyxcbiAga2V5Q29tbWFuZDogJ2xpc3QnLFxuICBzaG9ydGN1dHM6ICdjdHJsK3NoaWZ0K2MnLFxuICBidXR0b25Qcm9wczogeyAnYXJpYS1sYWJlbCc6ICdBZGQgY2hlY2tlZCBsaXN0JywgdGl0bGU6ICdBZGQgY2hlY2tlZCBsaXN0JyB9LFxuICBpY29uOiAoXG4gICAgPHN2ZyBkYXRhLW5hbWU9XCJjaGVja2VkLWxpc3RcIiB3aWR0aD1cIjEyXCIgaGVpZ2h0PVwiMTJcIiByb2xlPVwiaW1nXCIgdmlld0JveD1cIjAgMCA1MTIgNTEyXCI+XG4gICAgICA8cGF0aFxuICAgICAgICBmaWxsPVwiY3VycmVudENvbG9yXCJcbiAgICAgICAgZD1cIk0yMDggMTMyaDI4OGM4LjggMCAxNi03LjIgMTYtMTZWNzZjMC04LjgtNy4yLTE2LTE2LTE2SDIwOGMtOC44IDAtMTYgNy4yLTE2IDE2djQwYzAgOC44IDcuMiAxNiAxNiAxNnptMCAxNjBoMjg4YzguOCAwIDE2LTcuMiAxNi0xNnYtNDBjMC04LjgtNy4yLTE2LTE2LTE2SDIwOGMtOC44IDAtMTYgNy4yLTE2IDE2djQwYzAgOC44IDcuMiAxNiAxNiAxNnptMCAxNjBoMjg4YzguOCAwIDE2LTcuMiAxNi0xNnYtNDBjMC04LjgtNy4yLTE2LTE2LTE2SDIwOGMtOC44IDAtMTYgNy4yLTE2IDE2djQwYzAgOC44IDcuMiAxNiAxNiAxNnpNNjQgMzY4Yy0yNi41IDAtNDguNiAyMS41LTQ4LjYgNDhzMjIuMSA0OCA0OC42IDQ4IDQ4LTIxLjUgNDgtNDgtMjEuNS00OC00OC00OHptOTIuNS0yOTlsLTcyLjIgNzIuMi0xNS42IDE1LjZjLTQuNyA0LjctMTIuOSA0LjctMTcuNiAwTDMuNSAxMDkuNGMtNC43LTQuNy00LjctMTIuMyAwLTE3bDE1LjctMTUuN2M0LjctNC43IDEyLjMtNC43IDE3IDBsMjIuNyAyMi4xIDYzLjctNjMuM2M0LjctNC43IDEyLjMtNC43IDE3IDBsMTcgMTYuNWM0LjYgNC43IDQuNiAxMi4zLS4xIDE3em0wIDE1OS42bC03Mi4yIDcyLjItMTUuNyAxNS43Yy00LjcgNC43LTEyLjkgNC43LTE3LjYgMEwzLjUgMjY5Yy00LjctNC43LTQuNy0xMi4zIDAtMTdsMTUuNy0xNS43YzQuNy00LjcgMTIuMy00LjcgMTcgMGwyMi43IDIyLjEgNjMuNy02My43YzQuNy00LjcgMTIuMy00LjcgMTcgMGwxNyAxN2M0LjYgNC42IDQuNiAxMi4yLS4xIDE2Ljl6XCJcbiAgICAgIC8+XG4gICAgPC9zdmc+XG4gICksXG4gIGV4ZWN1dGU6IChzdGF0ZTogVGV4dFN0YXRlLCBhcGk6IFRleHRBcGkpID0+IHtcbiAgICBtYWtlTGlzdChzdGF0ZSwgYXBpLCAoaXRlbSwgaW5kZXgpID0+IGAtIFsgXSBgKTtcbiAgfSxcbn07XG4iXX0=