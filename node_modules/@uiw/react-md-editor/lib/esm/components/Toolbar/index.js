import _extends from "@babel/runtime/helpers/extends";
import _objectSpread from "@babel/runtime/helpers/objectSpread2";
import React, { Fragment, useContext } from 'react';
import { EditorContext } from '../../Context';
import Child from './Child';
import "./index.css";
export default function Toolbar() {
  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var prefixCls = props.prefixCls;

  var _useContext = useContext(EditorContext),
      commands = _useContext.commands,
      fullscreen = _useContext.fullscreen,
      preview = _useContext.preview,
      _useContext$barPopup = _useContext.barPopup,
      barPopup = _useContext$barPopup === void 0 ? {} : _useContext$barPopup,
      commandOrchestrator = _useContext.commandOrchestrator,
      dispatch = _useContext.dispatch;

  function handleClick(command, name) {
    if (!dispatch) return;
    var state = {
      barPopup: _objectSpread({}, barPopup)
    };

    if (command.keyCommand === 'preview') {
      state.preview = command.value;
    }

    if (command.keyCommand === 'fullscreen') {
      state.fullscreen = !fullscreen;
      document.body.style.overflow = fullscreen ? 'initial' : 'hidden';
    }

    if (commands && command.keyCommand === 'group') {
      commands.forEach(function (item) {
        if (name === item.groupName) {
          state.barPopup[name] = true;
        } else if (item.keyCommand) {
          state.barPopup[item.groupName] = false;
        }
      });
    } else if (name || command.parent) {
      Object.keys(state.barPopup || {}).forEach(function (keyName) {
        state.barPopup[keyName] = false;
      });
    }

    if (Object.keys(state).length) {
      dispatch(_objectSpread({}, state));
    }

    commandOrchestrator && commandOrchestrator.executeCommand(command);
  }

  return /*#__PURE__*/React.createElement("div", {
    className: "".concat(prefixCls, "-toolbar")
  }, /*#__PURE__*/React.createElement("ul", null, (props.commands || commands || []).map(function (item, idx) {
    if (item.keyCommand === 'divider') {
      return /*#__PURE__*/React.createElement("li", _extends({
        key: idx
      }, item.liProps, {
        className: "".concat(prefixCls, "-toolbar-divider")
      }));
    }

    if (!item.keyCommand) return /*#__PURE__*/React.createElement(Fragment, null);
    var activeBtn = fullscreen && item.keyCommand === 'fullscreen' || item.keyCommand === 'preview' && preview === item.value;
    var childNode = typeof item.children === 'function' ? item.children({
      getState: function getState() {
        return commandOrchestrator.getState();
      },
      textApi: commandOrchestrator ? commandOrchestrator.textApi : undefined,
      close: function close() {
        return handleClick({}, item.groupName);
      },
      execute: function execute() {
        return handleClick({
          execute: item.execute
        });
      }
    }) : undefined;
    var disabled = barPopup && preview && preview === 'preview' && !/(preview|fullscreen)/.test(item.keyCommand);
    return /*#__PURE__*/React.createElement("li", _extends({
      key: idx
    }, item.liProps, {
      className: activeBtn ? "active" : ''
    }), !item.buttonProps && item.icon, item.buttonProps && /*#__PURE__*/React.createElement('button', _objectSpread(_objectSpread({
      type: 'button',
      disabled: disabled,
      'data-name': item.name
    }, item.buttonProps), {}, {
      onClick: function onClick(evn) {
        evn.stopPropagation();
        handleClick(item, item.groupName);
      }
    }), item.icon), item.children && /*#__PURE__*/React.createElement(Child, {
      groupName: item.groupName,
      prefixCls: prefixCls,
      children: childNode,
      commands: Array.isArray(item.children) && typeof item.children !== 'function' ? item.children : undefined
    }));
  })));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1Rvb2xiYXIvaW5kZXgudHN4Il0sIm5hbWVzIjpbIlJlYWN0IiwiRnJhZ21lbnQiLCJ1c2VDb250ZXh0IiwiRWRpdG9yQ29udGV4dCIsIkNoaWxkIiwiVG9vbGJhciIsInByb3BzIiwicHJlZml4Q2xzIiwiY29tbWFuZHMiLCJmdWxsc2NyZWVuIiwicHJldmlldyIsImJhclBvcHVwIiwiY29tbWFuZE9yY2hlc3RyYXRvciIsImRpc3BhdGNoIiwiaGFuZGxlQ2xpY2siLCJjb21tYW5kIiwibmFtZSIsInN0YXRlIiwia2V5Q29tbWFuZCIsInZhbHVlIiwiZG9jdW1lbnQiLCJib2R5Iiwic3R5bGUiLCJvdmVyZmxvdyIsImZvckVhY2giLCJpdGVtIiwiZ3JvdXBOYW1lIiwicGFyZW50IiwiT2JqZWN0Iiwia2V5cyIsImtleU5hbWUiLCJsZW5ndGgiLCJleGVjdXRlQ29tbWFuZCIsIm1hcCIsImlkeCIsImxpUHJvcHMiLCJhY3RpdmVCdG4iLCJjaGlsZE5vZGUiLCJjaGlsZHJlbiIsImdldFN0YXRlIiwidGV4dEFwaSIsInVuZGVmaW5lZCIsImNsb3NlIiwiZXhlY3V0ZSIsImRpc2FibGVkIiwidGVzdCIsImJ1dHRvblByb3BzIiwiaWNvbiIsImNyZWF0ZUVsZW1lbnQiLCJ0eXBlIiwib25DbGljayIsImV2biIsInN0b3BQcm9wYWdhdGlvbiIsIkFycmF5IiwiaXNBcnJheSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxPQUFPQSxLQUFQLElBQWdCQyxRQUFoQixFQUEwQkMsVUFBMUIsUUFBNEMsT0FBNUM7QUFFQSxTQUFTQyxhQUFULFFBQXlELGVBQXpEO0FBRUEsT0FBT0MsS0FBUCxNQUFrQixTQUFsQjtBQUNBO0FBT0EsZUFBZSxTQUFTQyxPQUFULEdBQTRDO0FBQUEsTUFBM0JDLEtBQTJCLHVFQUFKLEVBQUk7QUFBQSxNQUNqREMsU0FEaUQsR0FDbkNELEtBRG1DLENBQ2pEQyxTQURpRDs7QUFBQSxvQkFFK0JMLFVB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LG1CQUFhbkIsSUFBSSxDQUFDVDtBQUx0QixPQU1PUyxJQUFJLENBQUNxQixXQU5aO0FBT0lJLE1BQUFBLE9BQU8sRUFBRSxpQkFBQ0MsR0FBRCxFQUEwRDtBQUNqRUEsUUFBQUEsR0FBRyxDQUFDQyxlQUFKO0FBQ0F0QyxRQUFBQSxXQUFXLENBQUNXLElBQUQsRUFBT0EsSUFBSSxDQUFDQyxTQUFaLENBQVg7QUFDRDtBQVZMLFFBWUVELElBQUksQ0FBQ3NCLElBWlAsQ0FISixFQWlCR3RCLElBQUksQ0FBQ2EsUUFBTCxpQkFDQyxvQkFBQyxLQUFEO0FBQ0UsTUFBQSxTQUFTLEVBQUViLElBQUksQ0FBQ0MsU0FEbEI7QUFFRSxNQUFBLFNBQVMsRUFBRW5CLFNBRmI7QUFHRSxNQUFBLFFBQVEsRUFBRThCLFNBSFo7QUFJRSxNQUFBLFFBQVEsRUFDTmdCLEtBQUssQ0FBQ0MsT0FBTixDQUFjN0IsSUFBSSxDQUFDYSxRQUFuQixLQUFnQyxPQUFPYixJQUFJLENBQUNhLFFBQVosS0FBeUIsVUFBekQsR0FBc0ViLElBQUksQ0FBQ2EsUUFBM0UsR0FBc0ZHO0FBTDFGLE1BbEJKLENBREY7QUE4QkQsR0FqREEsQ0FESCxDQURGLENBREY7QUF3REQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgRnJhZ21lbnQsIHVzZUNvbnRleHQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBJUHJvcHMgfSBmcm9tICcuLi8uLi91dGlscyc7XG5pbXBvcnQgeyBFZGl0b3JDb250ZXh0LCBQcmV2aWV3VHlwZSwgQ29udGV4dFN0b3JlIH0gZnJvbSAnLi4vLi4vQ29udGV4dCc7XG5pbXBvcnQgeyBJQ29tbWFuZCB9IGZyb20gJy4uLy4uL2NvbW1hbmRzJztcbmltcG9ydCBDaGlsZCBmcm9tICcuL0NoaWxkJztcbmltcG9ydCAnLi9pbmRleC5sZXNzJztcblxuZXhwb3J0IGludGVyZmFjZSBJVG9vbGJhclByb3BzIGV4dGVuZHMgSVByb3BzIHtcbiAgb25Db21tYW5kPzogKGNvbW1hbmQ6IElDb21tYW5kPHN0cmluZz4sIGdyb3VwTmFtZT86IHN0cmluZykgPT4gdm9pZDtcbiAgY29tbWFuZHM/OiBJQ29tbWFuZDxzdHJpbmc+W107XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIFRvb2xiYXIocHJvcHM6IElUb29sYmFyUHJvcHMgPSB7fSkge1xuICBjb25zdCB7IHByZWZpeENscyB9ID0gcHJvcHM7XG4gIGNvbnN0IHsgY29tbWFuZHMsIGZ1bGxzY3JlZW4sIHByZXZpZXcsIGJhclBvcHVwID0ge30sIGNvbW1hbmRPcmNoZXN0cmF0b3IsIGRpc3BhdGNoIH0gPSB1c2VDb250ZXh0KEVkaXRvckNvbnRleHQpO1xuICBmdW5jdGlvbiBoYW5kbGVDbGljayhjb21tYW5kOiBJQ29tbWFuZDxzdHJpbmc+LCBuYW1lPzogc3RyaW5nKSB7XG4gICAgaWYgKCFkaXNwYXRjaCkgcmV0dXJuO1xuICAgIGNvbnN0IHN0YXRlOiBDb250ZXh0U3RvcmUgPSB7IGJhclBvcHVwOiB7IC4uLmJhclBvcHVwIH0gfTtcbiAgICBpZiAoY29tbWFuZC5rZXlDb21tYW5kID09PSAncHJldmlldycpIHtcbiAgICAgIHN0YXRlLnByZXZpZXcgPSBjb21tYW5kLnZhbHVlIGFzIFByZXZpZXdUeXBlO1xuICAgIH1cbiAgICBpZiAoY29tbWFuZC5rZXlDb21tYW5kID09PSAnZnVsbHNjcmVlbicpIHtcbiAgICAgIHN0YXRlLmZ1bGxzY3JlZW4gPSAhZnVsbHNjcmVlbjtcbiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSBmdWxsc2NyZWVuID8gJ2luaXRpYWwnIDogJ2hpZGRlbic7XG4gICAgfVxuICAgIGlmIChjb21tYW5kcyAmJiBjb21tYW5kLmtleUNvbW1hbmQgPT09ICdncm91cCcpIHtcbiAgICAgIGNvbW1hbmRzLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgaWYgKG5hbWUgPT09IGl0ZW0uZ3JvdXBOYW1lKSB7XG4gICAgICAgICAgc3RhdGUuYmFyUG9wdXAhW25hbWUhXSA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoaXRlbS5rZXlDb21tYW5kKSB7XG4gICAgICAgICAgc3RhdGUuYmFyUG9wdXAhW2l0ZW0uZ3JvdXBOYW1lIV0gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChuYW1lIHx8IGNvbW1hbmQucGFyZW50KSB7XG4gICAgICBPYmplY3Qua2V5cyhzdGF0ZS5iYXJQb3B1cCB8fCB7fSkuZm9yRWFjaCgoa2V5TmFtZSkgPT4ge1xuICAgICAgICBzdGF0ZS5iYXJQb3B1cCFba2V5TmFtZV0gPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChPYmplY3Qua2V5cyhzdGF0ZSkubGVuZ3RoKSB7XG4gICAgICBkaXNwYXRjaCh7IC4uLnN0YXRlIH0pO1xuICAgIH1cbiAgICBjb21tYW5kT3JjaGVzdHJhdG9yICYmIGNvbW1hbmRPcmNoZXN0cmF0b3IuZXhlY3V0ZUNvbW1hbmQoY29tbWFuZCk7XG4gIH1cbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS10b29sYmFyYH0+XG4gICAgICA8dWw+XG4gICAgICAgIHsocHJvcHMuY29tbWFuZHMgfHwgY29tbWFuZHMgfHwgW10pLm1hcCgoaXRlbSwgaWR4KSA9PiB7XG4gICAgICAgICAgaWYgKGl0ZW0ua2V5Q29tbWFuZCA9PT0gJ2RpdmlkZXInKSB7XG4gICAgICAgICAgICByZXR1cm4gPGxpIGtleT17aWR4fSB7Li4uaXRlbS5saVByb3BzfSBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tdG9vbGJhci1kaXZpZGVyYH0gLz47XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghaXRlbS5rZXlDb21tYW5kKSByZXR1cm4gPEZyYWdtZW50IC8+O1xuICAgICAgICAgIGNvbnN0IGFjdGl2ZUJ0biA9XG4gICAgICAgICAgICAoZnVsbHNjcmVlbiAmJiBpdGVtLmtleUNvbW1hbmQgPT09ICdmdWxsc2NyZWVuJykgfHxcbiAgICAgICAgICAgIChpdGVtLmtleUNvbW1hbmQgPT09ICdwcmV2aWV3JyAmJiBwcmV2aWV3ID09PSBpdGVtLnZhbHVlKTtcbiAgICAgICAgICBjb25zdCBjaGlsZE5vZGUgPVxuICAgICAgICAgICAgdHlwZW9mIGl0ZW0uY2hpbGRyZW4gPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgPyBpdGVtLmNoaWxkcmVuKHtcbiAgICAgICAgICAgICAgICAgIGdldFN0YXRlOiAoKSA9PiBjb21tYW5kT3JjaGVzdHJhdG9yIS5nZXRTdGF0ZSgpLFxuICAgICAgICAgICAgICAgICAgdGV4dEFwaTogY29tbWFuZE9yY2hlc3RyYXRvciA/IGNvbW1hbmRPcmNoZXN0cmF0b3IhLnRleHRBcGkgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICBjbG9zZTogKCkgPT4gaGFuZGxlQ2xpY2soe30sIGl0ZW0uZ3JvdXBOYW1lKSxcbiAgICAgICAgICAgICAgICAgIGV4ZWN1dGU6ICgpID0+IGhhbmRsZUNsaWNrKHsgZXhlY3V0ZTogaXRlbS5leGVjdXRlIH0pLFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICAgIGNvbnN0IGRpc2FibGVkID1cbiAgICAgICAgICAgIGJhclBvcHVwICYmIHByZXZpZXcgJiYgcHJldmlldyA9PT0gJ3ByZXZpZXcnICYmICEvKHByZXZpZXd8ZnVsbHNjcmVlbikvLnRlc3QoaXRlbS5rZXlDb21tYW5kKTtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGxpIGtleT17aWR4fSB7Li4uaXRlbS5saVByb3BzfSBjbGFzc05hbWU9e2FjdGl2ZUJ0biA/IGBhY3RpdmVgIDogJyd9PlxuICAgICAgICAgICAgICB7IWl0ZW0uYnV0dG9uUHJvcHMgJiYgaXRlbS5pY29ufVxuICAgICAgICAgICAgICB7aXRlbS5idXR0b25Qcm9wcyAmJlxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAnYnV0dG9uJyxcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkLFxuICAgICAgICAgICAgICAgICAgICAnZGF0YS1uYW1lJzogaXRlbS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAuLi5pdGVtLmJ1dHRvblByb3BzLFxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiAoZXZuOiBSZWFjdC5Nb3VzZUV2ZW50PEhUTUxCdXR0b25FbGVtZW50LCBNb3VzZUV2ZW50PikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIGV2bi5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVDbGljayhpdGVtLCBpdGVtLmdyb3VwTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgaXRlbS5pY29uLFxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgIHtpdGVtLmNoaWxkcmVuICYmIChcbiAgICAgICAgICAgICAgICA8Q2hpbGRcbiAgICAgICAgICAgICAgICAgIGdyb3VwTmFtZT17aXRlbS5ncm91cE5hbWV9XG4gICAgICAgICAgICAgICAgICBwcmVmaXhDbHM9e3ByZWZpeENsc31cbiAgICAgICAgICAgICAgICAgIGNoaWxkcmVuPXtjaGlsZE5vZGV9XG4gICAgICAgICAgICAgICAgICBjb21tYW5kcz17XG4gICAgICAgICAgICAgICAgICAgIEFycmF5LmlzQXJyYXkoaXRlbS5jaGlsZHJlbikgJiYgdHlwZW9mIGl0ZW0uY2hpbGRyZW4gIT09ICdmdW5jdGlvbicgPyBpdGVtLmNoaWxkcmVuIDogdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgKTtcbiAgICAgICAgfSl9XG4gICAgICA8L3VsPlxuICAgIDwvZGl2PlxuICApO1xufVxuIl19