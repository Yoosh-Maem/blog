{"ast":null,"code":"import _createForOfIteratorHelper from \"@babel/runtime/helpers/createForOfIteratorHelper\";\nimport _extends from \"@babel/runtime/helpers/extends\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _objectSpread from \"@babel/runtime/helpers/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useEffect, useImperativeHandle } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport gfm from 'remark-gfm';\nimport rehypeRaw from 'rehype-raw';\nimport Prism from 'prismjs';\nimport 'prismjs/components/prism-markup';\nimport { loadLang } from './langs';\nimport \"./styles/markdown.css\";\nimport \"./styles/markdowncolor.css\";\nexport default /*#__PURE__*/React.forwardRef(function (props, ref) {\n  var _ref = props || {},\n      className = _ref.className,\n      source = _ref.source,\n      style = _ref.style,\n      onScroll = _ref.onScroll,\n      onMouseOver = _ref.onMouseOver,\n      _ref$warpperElement = _ref.warpperElement,\n      warpperElement = _ref$warpperElement === void 0 ? {} : _ref$warpperElement,\n      other = _objectWithoutProperties(_ref, [\"className\", \"source\", \"style\", \"onScroll\", \"onMouseOver\", \"warpperElement\"]);\n\n  var mdp = /*#__PURE__*/React.createRef();\n  var loadedLang = React.useRef(['markup']);\n  useEffect(function () {\n    highlight(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [source]);\n\n  function highlight() {\n    return _highlight.apply(this, arguments);\n  }\n\n  function _highlight() {\n    _highlight = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var codes, _iterator, _step, val, tag, lang;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (mdp.current) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 2:\n              codes = mdp.current.getElementsByTagName('code');\n              _iterator = _createForOfIteratorHelper(codes);\n              _context.prev = 4;\n\n              _iterator.s();\n\n            case 6:\n              if ((_step = _iterator.n()).done) {\n                _context.next = 24;\n                break;\n              }\n\n              val = _step.value;\n              tag = val.parentNode;\n\n              if (!(tag && tag.tagName === 'PRE' && /^language-/.test(val.className.trim()))) {\n                _context.next = 22;\n                break;\n              }\n\n              lang = val.className.trim().replace(/^language-/, '');\n              _context.prev = 11;\n\n              if (loadedLang.current.includes(lang)) {\n                _context.next = 16;\n                break;\n              }\n\n              loadedLang.current.push(lang);\n              _context.next = 16;\n              return loadLang(lang);\n\n            case 16:\n              _context.next = 18;\n              return Prism.highlightElement(val);\n\n            case 18:\n              _context.next = 22;\n              break;\n\n            case 20:\n              _context.prev = 20;\n              _context.t0 = _context[\"catch\"](11);\n\n            case 22:\n              _context.next = 6;\n              break;\n\n            case 24:\n              _context.next = 29;\n              break;\n\n            case 26:\n              _context.prev = 26;\n              _context.t1 = _context[\"catch\"](4);\n\n              _iterator.e(_context.t1);\n\n            case 29:\n              _context.prev = 29;\n\n              _iterator.f();\n\n              return _context.finish(29);\n\n            case 32:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[4, 26, 29, 32], [11, 20]]);\n    }));\n    return _highlight.apply(this, arguments);\n  }\n\n  useImperativeHandle(ref, function () {\n    return _objectSpread(_objectSpread({}, props), {}, {\n      lang: loadedLang.current,\n      mdp: mdp\n    });\n  }, [mdp, props]);\n  var cls = \"wmde-markdown wmde-markdown-color \".concat(className || '');\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: mdp,\n    onScroll: onScroll,\n    onMouseOver: onMouseOver\n  }, warpperElement, {\n    className: cls,\n    style: style\n  }), /*#__PURE__*/React.createElement(ReactMarkdown, _extends({}, other, {\n    plugins: [gfm].concat(_toConsumableArray(other.plugins || [])),\n    rehypePlugins: [rehypeRaw].concat(_toConsumableArray(other.rehypePlugins || []))\n  }), source || ''));\n});","map":{"version":3,"sources":["../../src/index.tsx"],"names":["className","source","style","onScroll","onMouseOver","warpperElement","other","props","mdp","React","loadedLang","useEffect","highlight","codes","val","tag","lang","loadLang","Prism","useImperativeHandle","cls"],"mappings":"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","sourcesContent":["import React, { useEffect, useImperativeHandle } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport gfm from 'remark-gfm';\nimport rehypeRaw from 'rehype-raw';\nimport Prism from 'prismjs';\nimport 'prismjs/components/prism-markup';\nimport { loadLang } from './langs';\nimport './styles/markdown.less';\nimport './styles/markdowncolor.less';\n\nexport type MarkdownPreviewProps = {\n  className?: string;\n  source?: string;\n  style?: React.CSSProperties;\n  warpperElement?: React.DetailedHTMLProps<React.HTMLAttributes<HTMLDivElement>, HTMLDivElement>;\n  onScroll?: (e: React.UIEvent<HTMLDivElement>) => void;\n  onMouseOver?: (e: React.MouseEvent<HTMLDivElement>) => void;\n} & Omit<ReactMarkdown.ReactMarkdownOptions, 'children'>;\n\nexport type MarkdownPreviewRef = {\n  mdp: React.RefObject<HTMLDivElement>;\n  lang: string[],\n} & MarkdownPreviewProps;\n\nexport default React.forwardRef<MarkdownPreviewRef, MarkdownPreviewProps>((props, ref) => {\n  const { className, source, style, onScroll, onMouseOver, warpperElement = {}, ...other  } = props || {};\n  const mdp = React.createRef<HTMLDivElement>();\n  const loadedLang = React.useRef<string[]>(['markup']);\n  useEffect(() => {\n    highlight();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [source]);\n\n  async function highlight() {\n    if (!mdp.current) return;\n    const codes = mdp.current.getElementsByTagName('code') as unknown as HTMLElement[];\n    for (const val of codes) {\n      const tag = val.parentNode as HTMLElement;\n      if (tag && tag.tagName === 'PRE' && /^language-/.test(val.className.trim())) {\n        const lang = val.className.trim().replace(/^language-/, '');\n        try {\n          if (!loadedLang.current.includes(lang as never)) {\n            loadedLang.current.push(lang);\n            await loadLang(lang);\n          }\n          await Prism.highlightElement(val);\n        } catch (error) { }\n      }\n    }\n  }\n\n  useImperativeHandle(ref, () => ({ ...props, lang: loadedLang.current, mdp }), [mdp, props]);\n\n  const cls = `wmde-markdown wmde-markdown-color ${className || ''}`;\n  return (\n    <div ref={mdp} onScroll={onScroll} onMouseOver={onMouseOver} {...warpperElement} className={cls} style={style}>\n      <ReactMarkdown\n        {...other}\n        plugins={[gfm,  ...(other.plugins || [])]}\n        rehypePlugins={[rehypeRaw, ...(other.rehypePlugins || [])]}\n      >\n        {source || ''}\n      </ReactMarkdown>\n    </div>\n  );\n});\n"]},"metadata":{},"sourceType":"module"}